# üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —ç—Å–∫—Ä–æ—É –¥–ª—è P2P —Ç–æ—Ä–≥–æ–≤–ª–∏

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚ùå **–≠—Å–∫—Ä–æ—É –ù–ï –ë–ï–ó–û–ü–ê–°–ï–ù** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–±–º–∞–Ω—É—Ç—å —Å–∏—Å—Ç–µ–º—É —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
- ‚ùå –¢–æ–∫–µ–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è —Ç—Ä–∞—Ç –≤ –¥—Ä—É–≥–∏—Ö –∫–æ—à–µ–ª—å–∫–∞—Ö

### –†–µ—à–µ–Ω–∏–µ - –°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —ç—Å–∫—Ä–æ—É:
- ‚úÖ –¢–æ–∫–µ–Ω—ã —Ä–µ–∞–ª—å–Ω–æ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
- ‚úÖ –ü–æ–ª–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å P2P —Å–¥–µ–ª–æ–∫

## üöÄ –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —ç—Å–∫—Ä–æ—É:

### 1. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
```solidity
// –ù—É–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —ç—Å–∫—Ä–æ—É –≤ —Å–µ—Ç–∏ Polygon
// –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–∑ smartContractService.js
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –í .env —Ñ–∞–π–ª–µ –¥–æ–±–∞–≤–∏—Ç—å:
USE_SMART_CONTRACT_ESCROW=true
ESCROW_CONTRACT_ADDRESS=0x... # –ê–¥—Ä–µ—Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
```

### 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—É–¥—É—Ç:
1. **–û–¥–æ–±—Ä–∏—Ç—å —Ç—Ä–∞—Ç—ã CES —Ç–æ–∫–µ–Ω–æ–≤** –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —ç—Å–∫—Ä–æ—É
2. **–ü–æ–¥–ø–∏—Å–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é** —Å–æ–∑–¥–∞–Ω–∏—è —ç—Å–∫—Ä–æ—É
3. **–î–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** –≤ –±–ª–æ–∫—á–µ–π–Ω–µ

## üìã –ê–ª–≥–æ—Ä–∏—Ç–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–π P2P —Å–¥–µ–ª–∫–∏:

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏
```javascript
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –æ—Ä–¥–µ—Ä –Ω–∞ –ø—Ä–æ–¥–∞–∂—É
// 2. –î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –∫—É–ø–∏—Ç—å
// 3. –°–ò–°–¢–ï–ú–ê: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å CES
```

### –≠—Ç–∞–ø 2: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ —ç—Å–∫—Ä–æ—É (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô)
```javascript
// 4. –ë–ï–ó–û–ü–ê–°–ù–û: –í—ã–∑—ã–≤–∞–µ–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç
await cesContract.approve(escrowContract, amount); // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–¥–æ–±—Ä—è–µ—Ç
await escrowContract.createEscrow(seller, buyer, amount, timelock); // –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–±–∏—Ä–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã

// 5. –¢–æ–∫–µ–Ω—ã –†–ï–ê–õ–¨–ù–û –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
// 6. –î–∞–∂–µ —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º –Ω–µ–ª—å–∑—è –∏—Ö –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å
```

### –≠—Ç–∞–ø 3: –û–ø–ª–∞—Ç–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```javascript
// 7. –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Ä—É–±–ª–∏
// 8. –ü—Ä–æ–¥–∞–≤–µ—Ü –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ
// 9. –°–ò–°–¢–ï–ú–ê: –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–∑ —ç—Å–∫—Ä–æ—É
await escrowContract.releaseEscrow(escrowId); // –¢–æ–∫–µ–Ω—ã –∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é
```

## üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

### 1. –ú—É–ª—å—Ç–∏-—Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –¥–ª—è —Å–ø–æ—Ä–æ–≤
```javascript
// –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ä–∞–∑—Ä–µ—à–∞—Ç—å —Å–ø–æ—Ä—ã
await escrowContract.resolveDispute(escrowId, favorBuyer);
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç
```javascript
// –¢–∞–π–º–∞—É—Ç - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç –ø—Ä–æ–¥–∞–≤—Ü—É
if (block.timestamp > escrow.deadline) {
    // –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü—É
}
```

### 3. –ó–∞–ø—Ä–µ—Ç –¥–≤–æ–π–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ—Ç –ª–∏ —É–∂–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç—Å–∫—Ä–æ—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const activeEscrows = await getActiveEscrowsForUser(userId);
if (activeEscrows.length > 0) {
    throw new Error('–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å–¥–µ–ª–∫–∞');
}
```

## ‚ö° –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ):

```javascript
// –í .env —Ñ–∞–π–ª–µ:
USE_SMART_CONTRACT_ESCROW=false // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ (–ù–ï –ë–ï–ó–û–ü–ê–°–ù–û)

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö:
// ‚ö†Ô∏è WARNING: Using DATABASE-ONLY escrow (NOT SECURE)
// ‚ö†Ô∏è DATABASE-ONLY: Locking 1.5 CES (NOT SECURE)
```

## üîß –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

- ‚úÖ –°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Å–∫—Ä–æ—É –≥–æ—Ç–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞ –≥–æ—Ç–æ–≤–∞
- ‚ùå –ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç
- ‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚ùå UI –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è —Ç—Ä–∞—Ç –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

## üö® –í–ù–ò–ú–ê–ù–ò–ï:
–î–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è —É—è–∑–≤–∏–º–æ–π!
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–±–º–∞–Ω—É—Ç—å —ç—Å–∫—Ä–æ—É —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏.