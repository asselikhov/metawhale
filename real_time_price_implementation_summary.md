# üî¥ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –¶–ï–ù–´ –í –†–ï–ñ–ò–ú–ï –†–ï–ê–õ–¨–ù–û–ì–û –í–†–ï–ú–ï–ù–ò

## üìã –û–±–∑–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω—ã CES –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è P2P –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏ —Ç–æ–∫–µ–Ω–æ–≤.

## ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üî¥ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (Real-Time)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥**
- **–í–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä**: üî¥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, üü¢ –¥–ª—è —Ä—É—á–Ω—ã—Ö
- **–ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **Interval-based updates**: `setInterval()` —Å 10-—Å–µ–∫—É–Ω–¥–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
- **Memory management**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
- **User-specific**: –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
- **Navigation cleanup**: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —ç–∫—Ä–∞–Ω–æ–≤

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `src/handlers/P2PHandler.js`
**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

#### `startRealTimePriceUpdates(ctx, sentMessage, orderType, walletInfo)`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `editMessageText()`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç ID –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è cleanup

#### `stopRealTimePriceUpdates(chatId)`
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—á–∏—â–∞–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏–∑ global Map
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ —ç–∫—Ä–∞–Ω–æ–≤

#### `handlePriceRefresh(ctx, orderType)`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ –∫–Ω–æ–ø–∫–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç üü¢ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Ä—É—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

#### `handleP2PBuyCES(ctx)` –∏ `handleP2PSellCES(ctx)`
- –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å "‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É..."
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ `startRealTimePriceUpdates()`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É"

#### `handleP2PMarketOrders(ctx)`
- –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `stopRealTimePriceUpdates()` –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### 2. `src/bot/telegramBot.js`
**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
```javascript
// Handle real-time price refresh for buy orders
this.bot.action('refresh_price_buy', (ctx) => {
  return messageHandler.handlePriceRefresh(ctx, 'buy');
});

// Handle real-time price refresh for sell orders
this.bot.action('refresh_price_sell', (ctx) => {
  return messageHandler.handlePriceRefresh(ctx, 'sell');
});
```

### 3. `src/handlers/messageHandler.js`
**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥:**
```javascript
// Handle real-time price refresh
async handlePriceRefresh(ctx, orderType) {
  return this.p2pHandler.handlePriceRefresh(ctx, orderType);
}
```

## üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –≠–∫—Ä–∞–Ω –ø–æ–∫—É–ø–∫–∏ CES
```
üìà –ü–û–ö–£–ü–ö–ê CES –¢–û–ö–ï–ù–û–í
‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ
–¢–µ–∫—É—â–∞—è —Ä—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞: ‚ÇΩ 246.96 / CES üî¥

‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ [–∫–æ–ª-–≤–æ, CES] [—Ü–µ–Ω–∞_–∑–∞_—Ç–æ–∫–µ–Ω, ‚ÇΩ] [–º–∏–Ω_—Å—É–º–º–∞, ‚ÇΩ] [–º–∞–∫—Å_—Å—É–º–º–∞, ‚ÇΩ]
üí° –ü—Ä–∏–º–µ—Ä: 10 245 1000 2500

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 0.1 CES
‚Ä¢ –ö–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: 1% (—Ç–æ–ª—å–∫–æ —Å –º–µ–π–∫–µ—Ä–æ–≤)

[üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É] [üîô –ù–∞–∑–∞–¥]
```

### –≠–∫—Ä–∞–Ω –ø—Ä–æ–¥–∞–∂–∏ CES
```
üìâ –ü–†–û–î–ê–ñ–ê CES –¢–û–ö–ï–ù–û–í
‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ
–¢–µ–∫—É—â–∞—è —Ä—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞: ‚ÇΩ 246.96 / CES üî¥
–í–∞—à –±–∞–ª–∞–Ω—Å: 15.0000 CES

‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ [–∫–æ–ª-–≤–æ, CES] [—Ü–µ–Ω–∞_–∑–∞_—Ç–æ–∫–µ–Ω, ‚ÇΩ] [–º–∏–Ω_—Å—É–º–º–∞, ‚ÇΩ] [–º–∞–∫—Å_—Å—É–º–º–∞, ‚ÇΩ]
üí° –ü—Ä–∏–º–µ—Ä: 50 253.5 1000 9000

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 0.1 CES
‚Ä¢ –ö–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: 1% (—Ç–æ–ª—å–∫–æ —Å –º–µ–π–∫–µ—Ä–æ–≤)

[üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É] [üîô –ù–∞–∑–∞–¥]
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Memory Management
```javascript
// Global storage for price update intervals
if (!global.priceUpdateIntervals) {
  global.priceUpdateIntervals = new Map();
}

// Auto-cleanup after 5 minutes
setTimeout(() => {
  this.stopRealTimePriceUpdates(chatId);
}, 300000); // 5 minutes
```

### Price Update Logic
```javascript
const updatePrice = async () => {
  try {
    const priceData = await p2pService.getMarketPriceSuggestion();
    
    // Update message with new price and üî¥ indicator
    await ctx.telegram.editMessageText(
      sentMessage.chat.id,
      sentMessage.message_id,
      null,
      message,
      { reply_markup: keyboard.reply_markup }
    );
  } catch (updateError) {
    // Don't break the cycle on update errors
  }
};

// Update every 10 seconds
const intervalId = setInterval(updatePrice, 10000);
```

### Visual Indicators
- **üî¥** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è)
- **üü¢** - –†—É—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø–æ –∫–Ω–æ–ø–∫–µ)
- **‚è≥** - –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω—ã

## üöÄ –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –î–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –¶–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—Ö–æ–¥–µ –Ω–∞ —ç–∫—Ä–∞–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª —É—Å—Ç–∞—Ä–µ–≤—à—É—é —Ü–µ–Ω—É
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –±—ã–ª–æ –≤—ã—Ö–æ–¥–∏—Ç—å –∏ –∑–∞—Ö–æ–¥–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ –∫–Ω–æ–ø–∫–µ
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —ç–∫—Ä–∞–Ω–æ–≤

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ `p2pService.getMarketPriceSuggestion()`
- Graceful error handling –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ü–∏–∫–ª–∞

### Error Handling
```javascript
try {
  // Update price logic
} catch (updateError) {
  console.error('Error updating real-time price:', updateError);
  // Don't break the cycle on update errors
}
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ä—ã–Ω–æ—á–Ω—É—é —Ü–µ–Ω—É CES –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–∞—Ö P2P —Ç–æ—Ä–≥–æ–≤–ª–∏. –¶–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ —Å –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

> "–¢–µ–∫—É—â–∞—è —Ä—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞: ‚ÇΩ 246.96 / CES –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏"

‚úÖ **–ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê** ‚úÖ